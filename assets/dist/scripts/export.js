/*! For license information please see export.js.LICENSE.txt */
(()=>{"use strict";function e(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)e[o]=n[o]}return e}var t={read:function(e){return e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};const n=function n(o,r){function i(t,n,i){if("undefined"!=typeof document){"number"==typeof(i=e({},r,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),n=o.write(n,t);var a="";for(var c in i)i[c]&&(a+="; "+c,!0!==i[c]&&(a+="="+i[c].split(";")[0]));return document.cookie=t+"="+n+a}}return Object.create({set:i,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],r={},i=0;i<n.length;i++){var a=n[i].split("="),c=a.slice(1).join("=");'"'===c[0]&&(c=c.slice(1,-1));try{var s=t.read(a[0]);if(r[s]=o.read(c,s),e===s)break}catch(e){}}return e?r[e]:r}},remove:function(t,n){i(t,"",e({},n,{expires:-1}))},withAttributes:function(t){return n(this.converter,e({},this.attributes,t))},withConverter:function(t){return n(e({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(o)}})}(t,{path:"/"}),o=function(e){var t=document.getElementById("pb-sse-seconds");document.getElementById("pb-sse-minutes").textContent="",t.textContent="",clearInterval(e)},r=function(e){return e>9?e:"0".concat(e)};jQuery((function(e){var t=e("#pb-export-form");t.on("submit",(function(n){n.preventDefault();var i=e("#pb-export-button"),a=e("#pb-sse-progressbar"),c=e("#pb-sse-info"),s=e(".notice"),p=null;a.val(0).show(),i.attr("disabled",!0).hide(),s.remove();var d=PB_ExportToken.ajaxUrl+(PB_ExportToken.ajaxUrl.includes("?")?"&":"?")+e.param(t.find(":checked")),l=new EventSource(d);l.onopen=function(){var t,n,o;t=document.getElementById("pb-sse-seconds"),n=document.getElementById("pb-sse-minutes"),o=0,n.textContent="00:",t.textContent="00",p=setInterval((function(){t.textContent=r(++o%60),n.textContent=r(parseInt(o/60,10))+":"}),1e3),e(window).on("beforeunload",(function(){return PB_ExportToken.unloadWarning}))},l.onmessage=function(t){var n=JSON.parse(t.data);switch(n.action){case"updateStatusBar":a.val(parseInt(n.percentage,10)),c.html(n.info);break;case"complete":l.close(),e(window).unbind("beforeunload"),n.error?(a.val(0).hide(),i.attr("disabled",!1).show(),function(e,t,n){var o,r=document.createElement("div"),i=document.createElement("p"),a=document.getElementsByTagName("h1")[0];if(i.setAttribute("aria-live","assertive"),i.insertAdjacentHTML("beforeend",t),r.classList.add("notice","notice-".concat(e)),r.appendChild(i),n){o=document.createElement("button");var c=document.createElement("span");o.classList.add("notice-dismiss"),c.classList.add("screen-reader-text"),c.appendChild(document.createTextNode("Dismiss this notice.")),o.appendChild(c),r.classList.add("is-dismissible"),r.appendChild(o)}a.parentNode.insertBefore(r,a.nextSibling),o&&(o.onclick=function(){r.parentNode.removeChild(r)})}("error",n.error,!0),p&&o(p)):window.location=PB_ExportToken.redirectUrl}},l.onerror=function(){l.close(),a.removeAttr("value"),c.html("EventStream Connection Error "+PB_ExportToken.reloadSnippet),e(window).unbind("beforeunload"),p&&o(p)}}));var i="pb_export",a=n.get(i);a=void 0===a?{}:JSON.parse(n.get(i));var c=document.getElementById("export-options"),s=c.querySelector(".handlediv");s.onclick=function(){var e="true"===s.getAttribute("aria-expanded")||!1;s.setAttribute("aria-expanded",!e),e?c.classList.add("closed"):c.classList.remove("closed")};var p=document.getElementById("bulk-action-selector-top"),d=document.getElementById("bulk-action-selector-bottom"),l=document.querySelector(".wp-list-table").parentNode;l.addEventListener("submit",(function(e){if(e.preventDefault(),("delete"===p.value||"delete"===d.value)&&!confirm(PB_ExportToken.bulkDeleteWarning))return!1;setTimeout((function(){l.submit()}),0)})),e("#pb-export-button").on("click",(function(t){t.preventDefault();var n=!1,o="";if(e("#pb-export-form input:checked").each((function(){o=e("label[for='"+e(this).attr("id")+"']").text().trim();var t=e(this).attr("name"),r=_pb_export_formats_map[t];if(Object.values(_pb_export_pins_inventory).filter((function(e){return e===r})).length>=3)return n=!0,!1})),n)return alert(o+": "+PB_ExportToken.tooManyExportsWarning),!1;e(".export-file-container").unbind("mouseenter mouseleave"),e(".export-control button").prop("disabled",!0),e("#pb-export-button").hide(),e("#loader").show();setTimeout((function(){e("#pb-export-form").submit()}),0)})),e("#pb-export-form").find("input").each((function(){var t=e(this).attr("name");if(jQuery.isEmptyObject(a))"export_formats[pdf]"===t||"export_formats[mpdf]"===t||"export_formats[epub]"===t?e(this).prop("checked",!0):e(this).prop("checked",!1);else{var n=0;Object.prototype.hasOwnProperty.call(a,t)&&(n=a[t]),e(this).prop("checked",!!n)}e(this).attr("disabled")&&e(this).prop("checked",!1)})).on("change",(function(){var t=e(this).attr("name");e(this).prop("checked")?a[t]=1:delete a[t],n.set(i,JSON.stringify(a),{path:"/",expires:365})}));var u=function(){var t=e("td.column-pin input").length;e("td.column-pin input:checked").length===t?e("#cb-select-all-1, #cb-select-all-2, #bulk-action-selector-top, #bulk-action-selector-bottom, #doaction, #doaction2").attr("disabled",!0):e("#cb-select-all-1, #cb-select-all-2, #bulk-action-selector-top, #bulk-action-selector-bottom, #doaction, #doaction2").attr("disabled",!1)};u(),e("td.column-pin").find("input").each((function(){if(e(this).prop("checked")){var t=e(this).closest("tr"),n=t.attr("data-id"),o=e("input[name='ID[]'][value='".concat(n,"']"));e(this).prop("checked",!0),o.prop("checked",!1),o.prop("disabled",!0),t.find("td.column-file span.delete").hide()}})).on("change",(function(){u();var t=e(this).attr("name"),n=e(this).closest("tr"),o=n.attr("data-id"),r=e("input[name='ID[]'][value='".concat(o,"']")),i=n.attr("data-format"),a=n.attr("data-file"),c=e(this).prop("checked")?1:0;if(c){if(_pb_export_pins_inventory[t]=i,Object.keys(_pb_export_pins_inventory).length>5)return delete _pb_export_pins_inventory[t],e(this).prop("checked",!1),alert(PB_ExportToken.maximumFilesWarning),!1;if(Object.values(_pb_export_pins_inventory).filter((function(e){return e===i})).length>3)return delete _pb_export_pins_inventory[t],e(this).prop("checked",!1),alert(PB_ExportToken.maximumFileTypeWarning),!1;r.prop("checked",!1),r.prop("disabled",!0),n.find("td.column-file span.delete").hide()}else delete _pb_export_pins_inventory[t],r.prop("disabled",!1),n.find("td.column-file span.delete").show();e.ajax({url:ajaxurl,type:"POST",data:{action:"pb_update_pins",pins:JSON.stringify(_pb_export_pins_inventory),file:a,pinned:c,_ajax_nonce:PB_ExportToken.pinsNonce},success:function(t){e("#pin-notifications").html(t.data.message)}})}))}))})();