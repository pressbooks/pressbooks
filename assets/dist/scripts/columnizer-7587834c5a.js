!function(e){e.fn.columnize=function(t){function i(e,t){try{e.append(t)}catch(i){e[0].appendChild(t[0])}}this.cols=[],this.offset=0,this.before=[],this.lastOther=0,this.prevMax=0,this.debug=0,this.setColumnStart=null,this.elipsisText="";var s={width:400,columns:!1,buildOnce:!1,overflow:!1,doneFunc:function(){},target:!1,ignoreImageLoading:!0,columnFloat:"left",lastNeverTallest:!1,accuracy:!1,precise:!1,manualBreaks:!1,cssClassPrefix:"",elipsisText:"...",debug:0};return t=e.extend(s,t),"string"==typeof t.width&&(t.width=parseInt(t.width,10),isNaN(t.width)&&(t.width=s.width)),"function"==typeof t.setColumnStart&&(this.setColumnStart=t.setColumnStart),"string"==typeof t.elipsisText&&(this.elipsisText=t.elipsisText),t.debug&&(this.debug=t.debug),t.setWidth||(t.precise?t.setWidth=function(e){return 100/e}:t.setWidth=function(e){return Math.floor(100/e)}),this.each(function(){function n(e,t){var i=t?".":"";return m.length?i+m+"-"+e:i+e}function l(s,l,o,r){for(;(g||o.height()<r)&&l[0].childNodes.length;){var a=l[0].childNodes[0];if(e(a).find(n("columnbreak",!0)).length)return;if(e(a).hasClass(n("columnbreak")))return;i(s,e(a))}if(0!==s[0].childNodes.length){var h=s[0].childNodes,d=h[h.length-1];s[0].removeChild(d);var f=e(d);if(3==f[0].nodeType){var c=f[0].nodeValue,u=t.width/18;t.accuracy&&(u=t.accuracy);for(var m,v=null;o.height()<r&&c.length;){var p=c.indexOf(" ",u);m=-1!=p?c.substring(0,p):c,v=document.createTextNode(m),i(s,e(v)),c=c.length>u&&-1!=p?c.substring(p):""}if(o.height()>=r&&null!==v&&(s[0].removeChild(v),c=v.nodeValue+c),!c.length)return!1;f[0].nodeValue=c}return l.contents().length?l.prepend(f):i(l,f),3==f[0].nodeType}}function o(e,t,s,r){if(!e.contents(":last").find(n("columnbreak",!0)).length&&!e.contents(":last").hasClass(n("columnbreak"))&&t.contents().length){var a=t.contents(":first");if("undefined"==typeof a.get(0)||1!=a.get(0).nodeType)return;var h=a.clone(!0);if(a.hasClass(n("columnbreak")))i(e,h),a.remove();else if(g)i(e,h),a.remove();else if(1==h.get(0).nodeType&&!h.hasClass(n("dontend")))if(i(e,h),h.is("img")&&s.height()<r+20)a.remove();else if(a.hasClass(n("dontsplit"))&&s.height()<r+20)a.remove();else if(h.is("img")||a.hasClass(n("dontsplit")))h.remove();else{if(h.empty(),l(h,a,s,r))a.addClass(n("split"));else{if(a.addClass(n("split")),"OL"==a.get(0).tagName){var d=h.get(0).childElementCount+h.get(0).start;a.attr("start",d+1)}a.children().length&&o(h,a,s,r)}if(0===h.get(0).childNodes.length)h.remove(),a.removeClass(n("split"));else if(1==h.get(0).childNodes.length){var f=h.get(0).childNodes[0];if(3==f.nodeType){var c=/\s/,u=f.nodeValue;c.test(u)&&(h.remove(),a.removeClass(n("split")))}}}}}function r(){if(!d.data("columnized")||1!=d.children().length){if(d.data("columnized",!0),d.data("columnizing",!0),d.empty(),d.append(e("<div class='"+n("first")+" "+n("last")+" "+n("column")+" ' style='width:100%; float: "+t.columnFloat+";'></div>")),$col=d.children().eq(d.children().length-1),$destroyable=c.clone(!0),t.overflow){for(targetHeight=t.overflow.height,l($col,$destroyable,$col,targetHeight),$destroyable.contents().find(":first-child").hasClass(n("dontend"))||o($col,$destroyable,$col,targetHeight);$col.contents(":last").length&&a($col.contents(":last").get(0));){var s=$col.contents(":last");s.remove(),$destroyable.prepend(s)}for(var r="",h=document.createElement("DIV");$destroyable[0].childNodes.length>0;){var f=$destroyable[0].childNodes[0];if(f.attributes)for(var u=0;u<f.attributes.length;u++)0===f.attributes[u].nodeName.indexOf("jQuery")&&f.removeAttribute(f.attributes[u].nodeName);h.innerHTML="",h.appendChild($destroyable[0].childNodes[0]),r+=h.innerHTML}var g=e(t.overflow.id)[0];g.innerHTML=r}else i($col,$destroyable.contents());d.data("columnizing",!1),t.overflow&&t.overflow.doneFunc&&t.overflow.doneFunc(),t.doneFunc()}}function a(t){return 3==t.nodeType?/^\s+$/.test(t.nodeValue)&&t.previousSibling?a(t.previousSibling):!1:1!=t.nodeType?!1:e(t).hasClass(n("dontend"))?!0:0===t.childNodes.length?!1:a(t.childNodes[t.childNodes.length-1])}function h(){if(v=0,u!=d.width()){u=d.width();var s=Math.round(d.width()/t.width),h=t.width,m=t.height;if(t.columns&&(s=t.columns),g&&(s=c.find(n("columnbreak",!0)).length+1,h=!1),1>=s)return r();if(!d.data("columnizing")){d.data("columnized",!0),d.data("columnizing",!0),d.empty(),d.append(e("<div style='width:"+t.setWidth(s)+"%; float: "+t.columnFloat+";'></div>")),N=d.children(":last"),i(N,c.clone()),f=N.height(),d.empty();var p=f/s,b=3,y=!1;t.overflow?(b=1,p=t.overflow.height):m&&h&&(b=1,p=m,y=!0);for(var w=0;b>w&&20>w;w++){d.empty();var x,C,N,T;try{x=c.clone(!0)}catch(L){x=c.clone()}x.css("visibility","hidden");for(var $=0;s>$;$++)C=0===$?n("first"):"",C+=" "+n("column"),C=$==s-1?n("last")+" "+C:C,d.append(e("<div class='"+C+"' style='width:"+t.setWidth(s)+"%; float: "+t.columnFloat+";'></div>"));for($=0;$<s-(t.overflow?0:1)||y&&x.contents().length;){for(d.children().length<=$&&d.append(e("<div class='"+C+"' style='width:"+t.setWidth(s)+"%; float: "+t.columnFloat+";'></div>")),N=d.children().eq($),y&&N.width(h+"px"),l(N,x,N,p),o(N,x,N,p);N.contents(":last").length&&a(N.contents(":last").get(0));)T=N.contents(":last"),T.remove(),x.prepend(T);$++,0===N.contents().length&&x.contents().length?N.append(x.contents(":first")):$!=s-(t.overflow?0:1)||t.overflow||x.find(n("columnbreak",!0)).length&&s++}if(t.overflow&&!y){var M=!1,O=document.all&&-1!=navigator.appVersion.indexOf("MSIE 7.");if(M||O){for(var S="",k=document.createElement("DIV");x[0].childNodes.length>0;){var F=x[0].childNodes[0];for($=0;$<F.attributes.length;$++)0===F.attributes[$].nodeName.indexOf("jQuery")&&F.removeAttribute(F.attributes[$].nodeName);k.innerHTML="",k.appendChild(x[0].childNodes[0]),S+=k.innerHTML}var z=e(t.overflow.id)[0];z.innerHTML=S}else e(t.overflow.id).empty().append(x.contents().clone(!0))}else if(y)d.children().each(function(e){N=d.children().eq(e),N.width(h+"px"),0===e?N.addClass(n("first")):e==d.children().length-1?N.addClass(n("last")):(N.removeClass(n("first")),N.removeClass(n("last")))}),d.width(d.children().length*h+"px");else{N=d.children().eq(d.children().length-1),x.contents().each(function(){N.append(e(this))});var H=(N.height(),0),I=1e7,V=0,W=!1,q=0;d.children().each(function(e){return function(t){var i=e.children().eq(t),s=i.children(":last").find(n("columnbreak",!0)).length;if(!s){var l=i.height();W=!1,H+=l,l>V&&(V=l,W=!0),I>l&&(I=l),q++}}}(d));var B=H/q;0===H?w=b:t.lastNeverTallest&&W?(v+=5,p+=30,w==b-1&&b++):V-I>30?p=B+30:Math.abs(B-p)>20?p=B:w=b}d.append(e("<br style='clear:both;'>"))}d.find(n("column",!0)).find(":first"+n("removeiffirst",!0)).remove(),d.find(n("column",!0)).find(":last"+n("removeiflast",!0)).remove(),d.find(n("split",!0)).find(":first"+n("removeiffirst",!0)).remove(),d.find(n("split",!0)).find(":last"+n("removeiflast",!0)).remove(),d.data("columnizing",!1),t.overflow&&t.overflow.doneFunc(),t.doneFunc()}}}var d=e(t.target?t.target:this),f=e(this).height(),c=e("<div></div>"),u=0,g=t.manualBreaks,m=s.cssClassPrefix;"string"==typeof t.cssClassPrefix&&(m=t.cssClassPrefix);var v=0;if(i(c,e(this).contents().clone(!0)),!t.ignoreImageLoading&&!t.target&&!d.data("imageLoaded")&&(d.data("imageLoaded",!0),e(this).find("img").length>0)){var p=function(e,s){return function(){e.data("firstImageLoaded")||(e.data("firstImageLoaded","true"),i(e.empty(),s.children().clone(!0)),e.columnize(t))}}(e(this),c);return e(this).find("img").one("load",p),void e(this).find("img").one("abort",p)}d.empty(),h(),t.buildOnce||e(window).resize(function(){t.buildOnce||(d.data("timeout")&&clearTimeout(d.data("timeout")),d.data("timeout",setTimeout(h,200)))})})},e.fn.renumberByJS=function(t,i,s,n){if(this.setList=function(t,i,s){var n,l=this.before.parents();if(n=e(t[this.offset-1]).find(">*"),n.last()[0].tagName!=s.toUpperCase())return this.debug&&console.log("Last item in previous column, isn't a list..."),0;n=n.length;var o=1;if(o=this.lastOther<=0?this.before.children().length+1:e(l[this.lastOther]).children().length+1,e(t[this.offset]).find(s+":first li.split").length){var r=e(t[this.offset-1]).find(s+":last li:last");if(""===this.elipsisText||e(t[this.offset-1]).find(s+":last ~ div").length||e(t[this.offset-1]).find(s+":last ~ p").length);else if(0==e(r).find("ul, ol, dl").length){var a=r.last().text(),h=a.length;";"==a.substring(h-1)?a.substring(h-4)!=this.elipsisText+";"&&(a=a.substring(0,h-1)+this.elipsisText+";"):a.substring(h-3)!=this.elipsisText&&(a+=this.elipsisText),r.last().text(a)}0==e(t[this.offset]).find(s+":first >li.split >"+s).length&&o--}if(1==n&&(o+=this.prevMax),this.nest>1){this.debug&&console.log("Supposed to be a nested list...decr"),o--;var d=e(t[this.offset-1]).find(s+":first li.split:first");d.length>0&&(this.debug&&console.log("Previous column started with a split item, so that count is one less than expected"),o--),d=e(t[this.offset]).find(s+":first li:first").clone(),d.children().remove(),e.trim(d.text()).length>0&&(this.debug&&console.log("If that was a complete list in the previous column, don't decr."),o++,0==e(t[this.offset-1]).find(">"+s+":last ").children().length&&(this.debug&&console.log("unless that was empty, in which case revert"),o--))}else{var d=e(t[this.offset]).find(s+":first li:first "+s+".split li.split");d.length>0&&(this.debug&&console.log("[Nested] Column started with a split item, so that count is one less than expected"),o--)}return this.debug&&console.log("Setting the start value to "+o+" ("+this.prevMax+")"),o>0&&("function"==typeof this.setColumnStart?this.setColumnStart(i,o):i.attr("start",o)),0},"undefined"==typeof s&&(s=!1),"undefined"==typeof n&&(n=!1),!s&&!n)throw"renumberByJS(): Bad param, must pass an id or a class";var l="";this.prevMax=1,l=n?"."+n:"#"+s;var o=t.toLowerCase(),r=t.toUpperCase();for(this.cols=e(l),this.debug&&console.log("There are "+this.cols.length+" items, looking for "+o),this.before=e(this.cols[0]).find(o+":last"),this.prevMax=this.before.children().length,this.offset=1;this.offset<this.cols.length;this.offset++)if(this.debug&&console.log("iterating "+this.offset+"...[of "+this.cols.length+"]"),this.offset%i!=0){if(this.before=e(this.cols[this.offset-1]).find(o+":last"),this.before.length){this.debug&&console.log("Have some "+t+" elements in the previous column");var a=e(this.cols[this.offset]).find(o+":first"),h=e(this.cols[this.offset]).find("*:first");if(h[0]!==a[0])continue;var d=this.before.parents();this.lastOther=0;for(var f=!1;this.lastOther<d.length;this.lastOther++)if(d[this.lastOther].tagName!=r&&"LI"!=d[this.lastOther].tagName){f=!0,this.lastOther--;break}this.nest=1,e(this.cols[this.offset]).find(">"+o+":first li "+o+":first").length&&(this.nest=2),this.setList(this.cols,a,o),this.lastOther--,a=e(this.cols[this.offset]).find(o+":first li "+o+":first"),a.length&&(this.before=e(this.cols[this.offset-1]).find(">"+o+":last li "+o+":last"),this.prevMax=0,this.nest=1,this.setList(this.cols,a,o));var c=e(this.cols[this.offset-1]).find(">"+o+":last");this.prevMax=c.children().length}}else this.debug&&console.log("First column (in theory..)"),this.prevMax=1;return 0}}(jQuery);