!function(t){t.fn.columnize=function(e){function i(t,e){try{t.append(e)}catch(i){t[0].appendChild(e[0])}}this.each(function(){var e=t(this);e.data("columnizer-original-dom",e.clone(!0,!0))}),this.cols=[],this.offset=0,this.before=[],this.lastOther=0,this.prevMax=0,this.debug=0,this.setColumnStart=null,this.elipsisText="";var s={width:400,columns:!1,buildOnce:!1,overflow:!1,doneFunc:function(){},target:!1,ignoreImageLoading:!0,columnFloat:"left",lastNeverTallest:!1,accuracy:!1,precise:!1,manualBreaks:!1,cssClassPrefix:"",elipsisText:"...",debug:0};return e=t.extend(s,e),"string"==typeof e.width&&(e.width=parseInt(e.width,10),isNaN(e.width)&&(e.width=s.width)),"function"==typeof e.setColumnStart&&(this.setColumnStart=e.setColumnStart),"string"==typeof e.elipsisText&&(this.elipsisText=e.elipsisText),e.debug&&(this.debug=e.debug),e.setWidth||(e.precise?e.setWidth=function(t){return 100/t}:e.setWidth=function(t){return Math.floor(100/t)}),this.each(function(){function n(t,e){var i=e?".":"";return v.length?i+v+"-"+t:i+t}function l(s,l,o,r){for(;(g||o.height()<r)&&l[0].childNodes.length;){var a=l[0].childNodes[0];if(t(a).find(n("columnbreak",!0)).length)return;if(t(a).hasClass(n("columnbreak")))return;i(s,t(a))}if(0!==s[0].childNodes.length){var h=s[0].childNodes,d=h[h.length-1];s[0].removeChild(d);var f=t(d);if(3==f[0].nodeType){var c=f[0].nodeValue,u=e.width/18;e.accuracy&&(u=e.accuracy);for(var v,m=null;o.height()<r&&c.length;){var p=c.indexOf(" ",u);v=-1!=p?c.substring(0,p):c,m=document.createTextNode(v),i(s,t(m)),c=c.length>u&&-1!=p?c.substring(p):""}if(o.height()>=r&&null!==m&&(s[0].removeChild(m),c=m.nodeValue+c),!c.length)return!1;f[0].nodeValue=c}return l.contents().length?l.prepend(f):i(l,f),3==f[0].nodeType}}function o(t,e,s,r){if(!t.contents(":last").find(n("columnbreak",!0)).length&&!t.contents(":last").hasClass(n("columnbreak"))&&e.contents().length){var a=e.contents(":first");if(void 0===a.get(0)||1!=a.get(0).nodeType)return;var h=a.clone(!0);if(a.hasClass(n("columnbreak")))i(t,h),a.remove();else if(g)i(t,h),a.remove();else if(1==h.get(0).nodeType&&!h.hasClass(n("dontend")))if(i(t,h),h.is("img")&&s.height()<r+20)a.remove();else if(a.hasClass(n("dontsplit"))&&s.height()<r+20)a.remove();else if(h.is("img")||a.hasClass(n("dontsplit")))h.remove();else{if(h.empty(),l(h,a,s,r))a.addClass(n("split"));else{if(a.addClass(n("split")),"OL"==a.get(0).tagName){var d=h.get(0).childElementCount+h.get(0).start;a.attr("start",d+1)}a.children().length&&o(h,a,s,r)}if(0===h.get(0).childNodes.length)h.remove(),a.removeClass(n("split"));else if(1==h.get(0).childNodes.length){var f=h.get(0).childNodes[0];if(3==f.nodeType){var c=/\S/,u=f.nodeValue;c.test(u)||(h.remove(),a.removeClass(n("split")))}}}}}function r(){if(!d.data("columnized")||1!=d.children().length){if(d.data("columnized",!0),d.data("columnizing",!0),d.empty(),d.append(t("<div class='"+n("first")+" "+n("last")+" "+n("column")+" ' style='width:100%; float: "+e.columnFloat+";'></div>")),$col=d.children().eq(d.children().length-1),$destroyable=c.clone(!0),e.overflow){for(targetHeight=e.overflow.height,l($col,$destroyable,$col,targetHeight),$destroyable.contents().find(":first-child").hasClass(n("dontend"))||o($col,$destroyable,$col,targetHeight);$col.contents(":last").length&&a($col.contents(":last").get(0));){var s=$col.contents(":last");s.remove(),$destroyable.prepend(s)}for(var r="",h=document.createElement("DIV");$destroyable[0].childNodes.length>0;){var f=$destroyable[0].childNodes[0];if(f.attributes)for(var u=0;u<f.attributes.length;u++)0===f.attributes[u].nodeName.indexOf("jQuery")&&f.removeAttribute(f.attributes[u].nodeName);h.innerHTML="",h.appendChild($destroyable[0].childNodes[0]),r+=h.innerHTML}t(e.overflow.id)[0].innerHTML=r}else i($col,$destroyable.contents());d.data("columnizing",!1),e.overflow&&e.overflow.doneFunc&&e.overflow.doneFunc(),e.doneFunc()}}function a(e){return 3==e.nodeType?!!/^\s+$/.test(e.nodeValue)&&(!!e.previousSibling&&a(e.previousSibling)):1==e.nodeType&&(!!t(e).hasClass(n("dontend"))||0!==e.childNodes.length&&a(e.childNodes[e.childNodes.length-1]))}function h(){if(m=0,u!=d.width()){u=d.width();var s=Math.round(d.width()/e.width),h=e.width,v=e.height;if(e.columns&&(s=e.columns),g&&(s=c.find(n("columnbreak",!0)).length+1,h=!1),s<=1)return r();if(!d.data("columnizing")){d.data("columnized",!0),d.data("columnizing",!0),d.empty(),d.append(t("<div style='width:"+e.setWidth(s)+"%; float: "+e.columnFloat+";'></div>")),N=d.children(":last"),i(N,c.clone()),f=N.height(),d.empty();var p=f/s,b=3,y=!1;e.overflow?(b=1,p=e.overflow.height):v&&h&&(b=1,p=v,y=!0);for(var w=0;w<b&&w<20;w++){d.empty();var C,x,N,T;try{C=c.clone(!0)}catch(t){C=c.clone()}C.css("visibility","hidden");for(var $=0;$<s;$++)x=0===$?n("first"):"",x+=" "+n("column"),x=$==s-1?n("last")+" "+x:x,d.append(t("<div class='"+x+"' style='width:"+e.setWidth(s)+"%; float: "+e.columnFloat+";'></div>"));for($=0;$<s-(e.overflow?0:1)||y&&C.contents().length;){for(d.children().length<=$&&d.append(t("<div class='"+x+"' style='width:"+e.setWidth(s)+"%; float: "+e.columnFloat+";'></div>")),N=d.children().eq($),y&&N.width(h+"px"),l(N,C,N,p),o(N,C,N,p);N.contents(":last").length&&a(N.contents(":last").get(0));)T=N.contents(":last"),T.remove(),C.prepend(T);$++,0===N.contents().length&&C.contents().length?N.append(C.contents(":first")):$!=s-(e.overflow?0:1)||e.overflow||C.find(n("columnbreak",!0)).length&&s++}if(e.overflow&&!y){if(document.all&&-1!=navigator.appVersion.indexOf("MSIE 7.")){for(var L="",O=document.createElement("DIV");C[0].childNodes.length>0;){var M=C[0].childNodes[0];for($=0;$<M.attributes.length;$++)0===M.attributes[$].nodeName.indexOf("jQuery")&&M.removeAttribute(M.attributes[$].nodeName);O.innerHTML="",O.appendChild(C[0].childNodes[0]),L+=O.innerHTML}t(e.overflow.id)[0].innerHTML=L}else t(e.overflow.id).empty().append(C.contents().clone(!0))}else if(y)d.children().each(function(t){N=d.children().eq(t),N.width(h+"px"),0===t?N.addClass(n("first")):t==d.children().length-1?N.addClass(n("last")):(N.removeClass(n("first")),N.removeClass(n("last")))}),d.width(d.children().length*h+"px");else{N=d.children().eq(d.children().length-1),C.contents().each(function(){N.append(t(this))});var z=(N.height(),0),S=1e7,k=0,F=!1,H=0;d.children().each(function(t){return function(e){var i=t.children().eq(e);if(!i.children(":last").find(n("columnbreak",!0)).length){var s=i.height();F=!1,z+=s,s>k&&(k=s,F=!0),s<S&&(S=s),H++}}}(d));var I=z/H;0===z?w=b:e.lastNeverTallest&&F?(m+=5,p+=30,w==b-1&&b++):k-S>30?p=I+30:Math.abs(I-p)>20?p=I:w=b}d.append(t("<br style='clear:both;'>"))}d.find(n("column",!0)).find(":first"+n("removeiffirst",!0)).remove(),d.find(n("column",!0)).find(":last"+n("removeiflast",!0)).remove(),d.find(n("split",!0)).find(":first"+n("removeiffirst",!0)).remove(),d.find(n("split",!0)).find(":last"+n("removeiflast",!0)).remove(),d.data("columnizing",!1),e.overflow&&e.overflow.doneFunc(),e.doneFunc()}}}var d=t(e.target?e.target:this),f=t(this).height(),c=t("<div></div>"),u=0,g=e.manualBreaks,v=s.cssClassPrefix;"string"==typeof e.cssClassPrefix&&(v=e.cssClassPrefix);var m=0;if(i(c,t(this).contents().clone(!0)),!e.ignoreImageLoading&&!e.target&&!d.data("imageLoaded")&&(d.data("imageLoaded",!0),t(this).find("img").length>0)){var p=function(t,s){return function(){t.data("firstImageLoaded")||(t.data("firstImageLoaded","true"),i(t.empty(),s.children().clone(!0)),t.columnize(e))}}(t(this),c);return t(this).find("img").one("load",p),void t(this).find("img").one("abort",p)}d.empty(),h(),e.buildOnce||t(window).resize(function(){e.buildOnce||(d.data("timeout")&&clearTimeout(d.data("timeout")),d.data("timeout",setTimeout(h,200)))})})},t.fn.uncolumnize=function(){this.each(function(){var e,i=t(this);(e=i.data("columnizer-original-dom"))&&i.replaceWith(e)})},t.fn.renumberByJS=function(e,i,s,n){if(this.setList=function(e,i,s){var n,l=this.before.parents();if(n=t(e[this.offset-1]).find(">*"),n.last()[0].tagName!=s.toUpperCase())return this.debug,0;n=n.length;var o=1;if(o=this.lastOther<=0?this.before.children().length+1:t(l[this.lastOther]).children().length+1,t(e[this.offset]).find(s+":first li.split").length){var r=t(e[this.offset-1]).find(s+":last li:last");if(""===this.elipsisText||t(e[this.offset-1]).find(s+":last ~ div").length||t(e[this.offset-1]).find(s+":last ~ p").length);else if(0==t(r).find("ul, ol, dl").length){var a=r.last().text(),h=a.length;";"==a.substring(h-1)?a.substring(h-4)!=this.elipsisText+";"&&(a=a.substring(0,h-1)+this.elipsisText+";"):a.substring(h-3)!=this.elipsisText&&(a+=this.elipsisText),r.last().text(a)}0==t(e[this.offset]).find(s+":first >li.split >"+s).length&&o--}if(1==n&&(o+=this.prevMax),this.nest>1){this.debug,o--;var d=t(e[this.offset-1]).find(s+":first li.split:first");d.length>0&&(this.debug,o--),d=t(e[this.offset]).find(s+":first li:first").clone(),d.children().remove(),t.trim(d.text()).length>0&&(this.debug,o++,0==t(e[this.offset-1]).find(">"+s+":last ").children().length&&(this.debug,o--))}else{var d=t(e[this.offset]).find(s+":first li:first "+s+".split li.split");d.length>0&&(this.debug,o--)}return this.debug,o>0&&("function"==typeof this.setColumnStart?this.setColumnStart(i,o):i.attr("start",o)),0},void 0===s&&(s=!1),void 0===n&&(n=!1),!s&&!n)throw"renumberByJS(): Bad param, must pass an id or a class";var l="";this.prevMax=1,l=n?"."+n:"#"+s;var o=e.toLowerCase(),r=e.toUpperCase();for(this.cols=t(l),this.debug,this.before=t(this.cols[0]).find(o+":last"),this.prevMax=this.before.children().length,this.offset=1;this.offset<this.cols.length;this.offset++)if(this.debug,this.offset%i!=0){if(this.before=t(this.cols[this.offset-1]).find(o+":last"),this.before.length){this.debug;var a=t(this.cols[this.offset]).find(o+":first"),h=t(this.cols[this.offset]).find("*:first");if(h[0]!==a[0])continue;var d=this.before.parents();this.lastOther=0;for(;this.lastOther<d.length;this.lastOther++)if(d[this.lastOther].tagName!=r&&"LI"!=d[this.lastOther].tagName){!0,this.lastOther--;break}this.nest=1,t(this.cols[this.offset]).find(">"+o+":first li "+o+":first").length&&(this.nest=2),this.setList(this.cols,a,o),this.lastOther--,a=t(this.cols[this.offset]).find(o+":first li "+o+":first"),a.length&&(this.before=t(this.cols[this.offset-1]).find(">"+o+":last li "+o+":last"),this.prevMax=0,this.nest=1,this.setList(this.cols,a,o));var f=t(this.cols[this.offset-1]).find(">"+o+":last");this.prevMax=f.children().length}}else this.debug,this.prevMax=1;return 0}}(jQuery);