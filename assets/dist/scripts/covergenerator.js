(()=>{"use strict";const e=function(e){var n=document.getElementById("pb-sse-seconds");document.getElementById("pb-sse-minutes").textContent="",n.textContent="",clearInterval(e)},n=function(e){return e>9?e:"0".concat(e)};jQuery((function(t){t(document).ready((function(){var e;t(".front-background-image-upload-button").on("click",(function(n){n.preventDefault(),e||(e=wp.media.frames.file_frame=wp.media({multiple:!1})).on("select",(function(){var n=e.state().get("selection").first().toJSON();t("#front_background_image").val(n.url),t(".front-background-image").attr("src",n.url),t(".front-background-image-preview-wrap").removeClass("hidden"),t(".front-background-image-upload-button, .front-background-image-description").addClass("hidden")})),e.open()}))})),t(".delete-front-background-image").on("click",(function(){t("#front_background_image").val(""),t(".front-background-image-preview-wrap").addClass("hidden"),t(".front-background-image-upload-button, .front-background-image-description").removeClass("hidden")}));var o=t("#ppi"),r=t("#custom_ppi");""!==o.val()&&r.parent().parent().hide(),o.on("change",(function(){""===t(this).val()?r.parent().parent().show():(r.parent().parent().hide(),r.val(t(this).val()))})),t(".colorpicker").wpColorPicker();var a=t(".settings-form"),i=t("#generate-pdf"),d=t("#generate-jpg"),c=t("#pb-sse-progressbar"),s=t("#pb-sse-info"),u=t(".notice"),l=null,m=function(n){var o=t("form."+n),r=PB_CoverGeneratorToken.ajaxUrl+(PB_CoverGeneratorToken.ajaxUrl.includes("?")?"&":"?")+t.param(o.find(":input")),a=new EventSource(r);a.onopen=function(){t(window).on("beforeunload",(function(){return PB_CoverGeneratorToken.unloadWarning}))},a.onmessage=function(n){var o=JSON.parse(n.data);switch(o.action){case"updateStatusBar":c.val(parseInt(o.percentage,10)),s.html(o.info);break;case"complete":a.close(),t(window).unbind("beforeunload"),o.error?(c.val(0).hide(),i.attr("disabled",!1).show(),d.attr("disabled",!1).show(),function(e,n,t){var o,r=document.createElement("div"),a=document.createElement("p"),i=document.getElementsByTagName("h1")[0];if(a.setAttribute("aria-live","assertive"),a.insertAdjacentHTML("beforeend",n),r.classList.add("notice","notice-".concat(e)),r.appendChild(a),t){o=document.createElement("button");var d=document.createElement("span");o.classList.add("notice-dismiss"),d.classList.add("screen-reader-text"),d.appendChild(document.createTextNode("Dismiss this notice.")),o.appendChild(d),r.classList.add("is-dismissible"),r.appendChild(o)}i.parentNode.insertBefore(r,i.nextSibling),o&&(o.onclick=function(){r.parentNode.removeChild(r)})}("error",o.error,!0),l&&e(l)):window.location=PB_CoverGeneratorToken.redirectUrl}},a.onerror=function(){a.close(),c.removeAttr("value"),s.html("EventStream Connection Error "+PB_CoverGeneratorToken.reloadSnippet),t(window).unbind("beforeunload"),l&&e(l)}};a.on("saveAndGenerate",(function(e,o){var r,a,p;return i.hide(),d.hide(),c.val(0).show(),u.remove(),r=document.getElementById("pb-sse-seconds"),a=document.getElementById("pb-sse-minutes"),p=0,a.textContent="00:",r.textContent="00",l=setInterval((function(){r.textContent=n(++p%60),a.textContent=n(parseInt(p/60,10))+":"}),1e3),s.html(PB_CoverGeneratorToken.ajaxSubmitMsg),t(this).ajaxSubmit({done:m(o),timeout:0}),!1})),i.on("click",(function(){var e=tinymce.get("pb_about_unlimited");if(e){var n=e.getContent();t("#pb_about_unlimited").val(n)}a.trigger("saveAndGenerate",["pdf"])})),d.on("click",(function(){a.trigger("saveAndGenerate",["jpg"])}))}))})();